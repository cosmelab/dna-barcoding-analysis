# HTML Report Design Specification

## Overview

This document specifies the design system for the 5 HTML reports generated by the DNA barcoding analysis pipeline. These reports are viewed by students on desktop computers during lab sessions.

**Design Goals:**
1. **Consistent** - All 5 reports share the same visual language
2. **Educational** - Clear, easy to interpret scientific data
3. **Professional** - Modern, polished appearance
4. **Responsive** - Mobile-ready for future website integration
5. **Maintainable** - Modular CSS prevents file bloat and overwrites

**Separation of Concerns:**
- **Report styles** (`tracking/styles/`) - For generated HTML reports (this spec)
- **Website styles** (future) - For documentation website (separate CSS)

---

## Color Scheme: "Dracula Lite"

Inspired by Dracula theme but optimized for data readability.

### Core Colors

```css
/* Dracula-inspired accents */
--purple: #bd93f9;        /* Primary accent */
--pink: #ff79c6;          /* Secondary accent */
--cyan: #8be9fd;          /* Highlights */
--green: #50fa7b;         /* Success states */
--orange: #ffb86c;        /* Warnings */
--red: #ff5555;           /* Errors */
--yellow: #f1fa8c;        /* Attention */

/* Backgrounds (lighter for data readability) */
--bg-primary: #ffffff;    /* Main content */
--bg-secondary: #f8f9fa;  /* Alternating rows */
--bg-tertiary: #f0f1f5;   /* Sidebar/sections */
--bg-dark: #2d2d44;       /* Dark headers */

/* Text */
--text-primary: #2d3436;  /* Main text */
--text-secondary: #636e72;/* Secondary text */
--text-light: #b2bec3;    /* Muted text */
--text-on-dark: #f8f8f2;  /* Text on dark backgrounds */

/* Status colors */
--status-pass: #50fa7b;
--status-warn: #ffb86c;
--status-fail: #ff5555;
```

### Design Rationale

- **Light backgrounds** - Better for reading tables, sequences, and data
- **Dark headers** - Dramatic Dracula-style headers with light text
- **Colorful accents** - Guide attention to important metrics
- **Consistent status colors** - Green=pass, Orange=warning, Red=fail

---

## Typography

### Font Stack

```css
--font-primary: 'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
--font-mono: 'Courier New', Consolas, Monaco, monospace;
--font-heading: 'Maven Pro', 'Open Sans', sans-serif;
```

### Scale

```css
--text-xs: 0.75rem;   /* 12px - Fine print */
--text-sm: 0.875rem;  /* 14px - Secondary text */
--text-base: 1rem;    /* 16px - Body text */
--text-lg: 1.125rem;  /* 18px - Subheadings */
--text-xl: 1.25rem;   /* 20px - Section titles */
--text-2xl: 1.5rem;   /* 24px - Page titles */
--text-3xl: 2rem;     /* 32px - Hero text */
```

---

## Layout Structure

### Common Structure (All Reports)

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[Report Type] Report</title>
    <link rel="stylesheet" href="[path]/tracking/styles/base.css">
    <link rel="stylesheet" href="[path]/tracking/styles/components.css">
    <link rel="stylesheet" href="[path]/tracking/styles/reports.css">
    <link rel="stylesheet" href="[path]/tracking/styles/chromatogram.css">
</head>
<body>
    <!-- Header with progress indicator -->
    <header class="report-header">
        <h1>ğŸ§¬ Report Title</h1>
        <div class="progress-badge">Step X of 5</div>
    </header>

    <!-- Summary dashboard -->
    <section class="summary-dashboard">
        <div class="metric-card metric-primary">...</div>
        <div class="metric-card metric-success">...</div>
        <div class="metric-card metric-warning">...</div>
    </section>

    <!-- Main content -->
    <main class="report-content">
        <!-- Tables, results, visualizations -->
    </main>

    <!-- Help section -->
    <footer class="report-footer">
        <div class="help-section">
            <h3>What do these results mean?</h3>
            ...
        </div>
    </footer>
</body>
</html>
```

### Grid System

- **Container max-width:** 1400px (widescreen data tables)
- **Breakpoints:**
  - Desktop: â‰¥1200px
  - Tablet: 768px-1199px
  - Mobile: <768px

---

## Component Library

### 1. Metric Cards

**Usage:** Summary statistics at top of reports

```html
<div class="metric-card metric-success">
    <div class="metric-value">12</div>
    <div class="metric-label">Sequences Passed QC</div>
    <div class="metric-icon">âœ“</div>
</div>
```

**Variants:**
- `.metric-primary` - Purple accent (neutral stats)
- `.metric-success` - Green (passed/good)
- `.metric-warning` - Orange (warnings)
- `.metric-fail` - Red (failed/errors)

### 2. Data Tables

**Features:**
- Zebra striping (alternating row colors)
- Sticky header on scroll
- Hover highlighting
- Status badges in cells
- Sortable columns (future)

```html
<table class="data-table">
    <thead>
        <tr>
            <th>Sample ID</th>
            <th>Status</th>
            <th>Quality Score</th>
        </tr>
    </thead>
    <tbody>
        <tr class="row-pass">
            <td>AT-HV1</td>
            <td><span class="badge badge-success">PASS</span></td>
            <td>54.4</td>
        </tr>
    </tbody>
</table>
```

### 3. Collapsible Sections

**Usage:** Hide/show detailed results

```html
<div class="collapsible-section">
    <button class="collapsible-toggle">
        <span class="toggle-icon">â–¶</span>
        Sample AT-HV1 Details
    </button>
    <div class="collapsible-content">
        <!-- Chromatogram, metrics, etc. -->
    </div>
</div>
```

### 4. Status Badges

```html
<span class="badge badge-success">PASS</span>
<span class="badge badge-warning">WARNING</span>
<span class="badge badge-fail">FAIL</span>
```

### 5. Info Boxes

```html
<div class="info-box info-tip">
    <strong>ğŸ’¡ Tip:</strong> High quality scores (Q>30) indicate reliable base calls.
</div>

<div class="info-box info-warning">
    <strong>âš ï¸ Note:</strong> Sequences shorter than 500bp may not be suitable for identification.
</div>
```

---

## Chromatogram Visualization

### Current Issues

1. **Scale mismatch** - Title says "Bases 50-200" but X-axis shows trace positions (0-1750)
2. **Fixed window** - Can't see full sequence quality
3. **No context** - Students don't know where they are in the sequence

### New Design: Responsive Sliding Window

#### Desktop View (1200px+)
```
Window size: 150bp visible
Total range: Full sequence length
Controls: Slider + arrow buttons
```

#### Tablet View (768-1199px)
```
Window size: 100bp visible
```

#### Mobile View (<768px)
```
Window size: 50bp visible (future)
```

### Components

**1. Chromatogram Overview Bar**
```html
<div class="chrom-overview">
    <div class="quality-heatmap">
        <!-- Color-coded quality across full sequence -->
        <div class="q-high"></div>  <!-- Green: Qâ‰¥30 -->
        <div class="q-med"></div>   <!-- Orange: Q 20-29 -->
        <div class="q-low"></div>   <!-- Red: Q<20 -->
    </div>
    <div class="window-indicator"></div> <!-- Shows current view -->
</div>
```

**2. Interactive Window**
```html
<div class="chrom-viewer">
    <canvas id="chromatogram" width="1200" height="400"></canvas>
    <div class="chrom-controls">
        <button class="btn-nav" data-dir="start">â® Start</button>
        <button class="btn-nav" data-dir="prev">â—€ Prev</button>
        <input type="range" id="position-slider" min="0" max="[seq-length]">
        <button class="btn-nav" data-dir="next">Next â–¶</button>
        <button class="btn-nav" data-dir="end">End â­</button>
    </div>
    <div class="chrom-info">
        Showing bases <span id="start-pos">50</span> - <span id="end-pos">200</span>
        of <span id="total-length">750</span>
    </div>
</div>
```

### X-Axis Fix

**Current (WRONG):**
```python
ax.set_xlabel('Trace Position', fontsize=10)  # Shows 0-1750
```

**Fixed:**
```python
ax.set_xlabel(f'Base Position ({start_base}-{end_base})', fontsize=10)
# Set x-ticks to show base numbers, not trace positions
ax.set_xticks(np.linspace(0, len(trace), num=10))
ax.set_xticklabels(np.linspace(start_base, end_base, num=10, dtype=int))
```

---

## Report-Specific Features

### 1. QC Report (01_quality_control)

**Summary Metrics:**
- Total sequences analyzed
- Passed QC count
- Failed QC count
- Pass rate percentage

**Features:**
- Collapsible chromatograms (collapsed by default)
- Group by pass/fail with tabs
- Quick filter: Show only failed samples

### 2. Consensus Report (02_consensus)

**Summary Metrics:**
- Total samples
- Consensus created (F+R pairs)
- Forward only
- Reverse only
- Unpaired

**Features:**
- Show F vs R read lengths
- Highlight samples missing a direction

### 3. Alignment Report (03_alignment)

**Summary Metrics:**
- Sequences aligned
- Alignment length
- Gap percentage
- Conserved positions

**Features:**
- Scrollable alignment viewer
- Color-coded bases
- Consensus sequence highlighted

### 4. Phylogeny Report (04_phylogeny)

**Summary Metrics:**
- Sequences in tree
- Reference sequences
- Student sequences
- Bootstrap support

**Features:**
- Large tree visualization
- Zoom controls
- Highlight student samples in tree
- Download tree file button

### 5. BLAST Report (05_identification)

**Summary Metrics:**
- Sequences identified
- Top species found
- Average identity %

**Features:**
- Collapsible hit tables (show top 1 by default)
- Common names prominent
- Identity % color-coded (>97% green, 90-97% orange, <90% red)

---

## Interactive Elements

### Priority Features

**Phase 1 (Now):**
1. âœ… Collapsible sections
2. âœ… Responsive sliding window chromatogram
3. âœ… Fixed X-axis scale

**Phase 2 (Soon):**
4. Tooltips on hover (explain technical terms)
5. Sortable tables (by column)
6. Filter/search samples

**Phase 3 (Future):**
7. Export to CSV
8. Print-friendly view
9. Side-by-side comparison

### JavaScript Requirements

```javascript
// Collapsible sections
document.querySelectorAll('.collapsible-toggle').forEach(btn => {
    btn.addEventListener('click', () => {
        btn.parentElement.classList.toggle('expanded');
    });
});

// Chromatogram slider
const slider = document.getElementById('position-slider');
slider.addEventListener('input', (e) => {
    updateChromatogramView(e.target.value);
});
```

---

## CSS Architecture

### File Structure

```
tracking/styles/
â”œâ”€â”€ base.css          (~150 lines)
â”‚   â”œâ”€â”€ CSS variables (colors, fonts, spacing)
â”‚   â”œâ”€â”€ CSS reset (normalize)
â”‚   â””â”€â”€ Typography base styles
â”‚
â”œâ”€â”€ components.css    (~300 lines)
â”‚   â”œâ”€â”€ Buttons
â”‚   â”œâ”€â”€ Badges
â”‚   â”œâ”€â”€ Cards (metric cards, info boxes)
â”‚   â”œâ”€â”€ Tables
â”‚   â”œâ”€â”€ Collapsible sections
â”‚   â””â”€â”€ Tooltips
â”‚
â”œâ”€â”€ chromatogram.css  (~200 lines)
â”‚   â”œâ”€â”€ Chromatogram viewer
â”‚   â”œâ”€â”€ Quality heatmap
â”‚   â”œâ”€â”€ Controls (slider, buttons)
â”‚   â””â”€â”€ Responsive breakpoints
â”‚
â””â”€â”€ reports.css       (~250 lines)
    â”œâ”€â”€ Report header
    â”œâ”€â”€ Summary dashboard layout
    â”œâ”€â”€ Main content grid
    â”œâ”€â”€ Footer styles
    â””â”€â”€ Print styles
```

**Total: ~900 lines across 4 files**

### Benefits of Modular Approach

1. **No 7k-line monsters** - Each file focused and manageable
2. **No overwrites** - Clear separation of concerns
3. **Easy updates** - Change chromatogram styles without touching tables
4. **Selective loading** - Future: load only needed CSS per report type
5. **Version control friendly** - Smaller diffs, easier code reviews

---

## Responsive Design

### Breakpoints

```css
/* Mobile first approach */
.summary-dashboard {
    display: flex;
    flex-direction: column; /* Stack on mobile */
}

@media (min-width: 768px) {
    .summary-dashboard {
        flex-direction: row; /* Side-by-side on tablet+ */
    }
}

@media (min-width: 1200px) {
    .summary-dashboard {
        display: grid;
        grid-template-columns: repeat(4, 1fr); /* 4-column on desktop */
    }
}
```

### Chromatogram Responsiveness

```css
.chrom-viewer {
    --window-size: 50;  /* Mobile: 50bp */
}

@media (min-width: 768px) {
    .chrom-viewer {
        --window-size: 100; /* Tablet: 100bp */
    }
}

@media (min-width: 1200px) {
    .chrom-viewer {
        --window-size: 150; /* Desktop: 150bp */
    }
}
```

---

## Browser Support

**Target browsers:**
- Chrome/Edge 90+ (primary - students use Chrome)
- Firefox 88+
- Safari 14+

**Graceful degradation:**
- CSS Grid with flexbox fallback
- Custom properties with fallback colors
- JavaScript optional (reports readable without JS)

---

## Accessibility

1. **Semantic HTML** - Proper heading hierarchy
2. **Alt text** - All images including chromatograms
3. **Color contrast** - WCAG AA minimum (4.5:1)
4. **Keyboard navigation** - All interactive elements
5. **Screen reader support** - ARIA labels where needed

---

## Performance

**Optimization strategies:**
1. **Inline critical CSS** - Above-the-fold styles in <head>
2. **Lazy load images** - Chromatograms load as sections expand
3. **Minify in production** - Compressed CSS/JS for deployment
4. **Base64 embed small images** - Icons, logos (<10KB)

---

## Future Considerations

### Website vs Reports

**Reports (this spec):**
- Simple, focused HTML files
- Generated by Python scripts
- Viewed during lab sessions
- Desktop-optimized

**Website (future - separate spec):**
- Full Dracula theme
- Navigation, multiple pages
- Documentation, tutorials
- Mobile-first

**Keep separate CSS to avoid conflicts!**

---

## Implementation Checklist

- [ ] Create `tracking/styles/` directory
- [ ] Write `base.css` with color system
- [ ] Write `components.css` with UI elements
- [ ] Write `chromatogram.css` with viewer
- [ ] Write `reports.css` with layouts
- [ ] Update `qc_chromatograms.py` to use new CSS
- [ ] Update `create_consensus.py` to use new CSS
- [ ] Update `align_sequences.py` to use new CSS
- [ ] Update `build_tree.py` to use new CSS
- [ ] Update `identify_species.py` to use new CSS
- [ ] Test on Windows (user's test machine)
- [ ] Test on macOS (dev machine)
- [ ] Document in tracking/decisions.yaml

---

**Last Updated:** 2025-11-21
**Status:** Design specification complete, ready for implementation
